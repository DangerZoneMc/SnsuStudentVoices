import{T as $,j as b,f as d,o as n,b as t,k as S,a as p,v as B,u as a,w as f,e as C,d as _,g as v,F as q,l as F,c as z,t as h,m as R,p as j,n as D}from"./app-CRkK36wv.js";import{d as L,r as I,_ as V,a as T}from"./AuthenticatedLayout-wYXvNF2a.js";import{_ as M}from"./InputError-DZ_DqzMn.js";import{P as E}from"./PrimaryButton-YFl2EgGx.js";const W={class:"mt-4"},A={class:"mt-4 space-y-4"},O={class:"flex items-center justify-between"},P={class:"flex items-center space-x-2"},Y={class:"font-medium text-gray-900"},G={class:"text-gray-500"},H=["onClick"],J=["onClick"],K={key:0,class:"mt-2"},Q=["onSubmit"],X={class:"flex space-x-2 mt-2"},Z={key:1,class:"mt-2 text-gray-700"},ee={key:0,class:"text-gray-500 text-center"},te={__name:"CommentSection",props:{chirpId:{type:Number,required:!0},comments:{type:Array,required:!0}},setup(o){L.extend(I);const m=o,i=$({content:""}),c=b(null),s=$({content:""}),y=()=>{i.content.trim()&&i.post(route("chirps.comments.store",{chirp:m.chirpId}),{preserveScroll:!0,preserveSnapshot:!0,onSuccess:()=>{i.reset()}})},u=r=>{c.value=r.id,s.content=r.content},g=()=>{c.value=null,s.reset()},k=r=>{s.content.trim()&&s.patch(route("chirps.comments.update",{chirp:m.chirpId,comment:r}),{preserveScroll:!0,onSuccess:()=>{c.value=null,s.reset()},onError:e=>{console.error("Failed to update comment:",e)}})},x=r=>{confirm("Are you sure you want to delete this comment?")&&i.delete(route("chirps.comments.destroy",{chirp:m.chirpId,comment:r}),{preserveScroll:!0})};return(r,e)=>(n(),d("div",W,[t("form",{onSubmit:_(y,["prevent"])},[S(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=l=>a(i).content=l),placeholder:"Write a comment...",class:"w-full border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 rounded-md shadow-sm",rows:"2"},null,512),[[B,a(i).content]]),p(M,{message:a(i).errors.content,class:"mt-2"},null,8,["message"]),p(E,{class:"mt-2",disabled:a(i).processing||!a(i).content.trim()},{default:f(()=>e[2]||(e[2]=[C(" Comment ")])),_:1},8,["disabled"])],32),t("div",A,[(n(!0),d(q,null,F(o.comments,l=>{var N,U;return n(),d("div",{key:l.id,class:"p-4 bg-gray-50 rounded-lg"},[t("div",O,[t("div",P,[t("span",Y,h((N=l.user)==null?void 0:N.name),1),t("small",G,h(a(L)(l.created_at).fromNow()),1)]),((U=l.user)==null?void 0:U.id)===r.$page.props.auth.user.id?(n(),z(V,{key:0,align:"right",width:"48"},{trigger:f(()=>e[3]||(e[3]=[t("button",{class:"flex items-center text-gray-400 hover:text-gray-600"},[t("svg",{class:"w-5 h-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})])],-1)])),content:f(()=>[t("button",{class:"block w-full px-4 py-2 text-left text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:bg-gray-100",onClick:w=>u(l)}," Edit ",8,H),t("button",{class:"block w-full px-4 py-2 text-left text-sm leading-5 text-red-600 hover:bg-gray-100 focus:bg-gray-100",onClick:w=>x(l.id)}," Delete ",8,J)]),_:2},1024)):v("",!0)]),c.value===l.id?(n(),d("div",K,[t("form",{onSubmit:_(w=>k(l.id),["prevent"])},[S(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=w=>a(s).content=w),class:"w-full border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 rounded-md shadow-sm",rows:"2",required:""},null,512),[[B,a(s).content]]),p(M,{message:a(s).errors.content,class:"mt-2"},null,8,["message"]),t("div",X,[p(E,{disabled:a(s).processing||!a(s).content.trim(),type:"submit"},{default:f(()=>e[4]||(e[4]=[C(" Save Changes ")])),_:1},8,["disabled"]),t("button",{type:"button",class:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900 border border-gray-300 rounded-md",onClick:g}," Cancel ")])],40,Q)])):(n(),d("p",Z,h(l.content),1))])}),128)),o.comments.length?v("",!0):(n(),d("p",ee," No comments yet. Be the first to comment! "))])]))}},se={key:0,class:"flex items-center space-x-1"},re={key:1,class:"flex items-center space-x-1"},oe={__name:"LikeButton",props:{chirpId:{type:Number,required:!0},likes:{type:Number,required:!0},isLiked:{type:Boolean,required:!0}},setup(o){const m=o,i=$({}),c=b(m.likes),s=b(m.isLiked);R(()=>{s.value=m.isLiked}),j(()=>m.isLiked,u=>{s.value=u}),j(()=>m.likes,u=>{c.value=u});const y=()=>{s.value=!s.value,c.value=s.value?c.value+1:c.value-1,i.post(route("chirps.like",{chirp:m.chirpId}),{preserveScroll:!0,onSuccess:u=>{s.value=u.props.isLiked,c.value=u.props.likes},onError:()=>{s.value=!s.value,c.value=s.value?c.value+1:c.value-1}})};return(u,g)=>(n(),d("button",{onClick:y,class:"flex items-center space-x-1 text-sm text-gray-600 hover:text-blue-500 transition"},[s.value?(n(),d("span",se,g[0]||(g[0]=[t("span",{class:"text-blue-500"},"👍",-1),t("span",{class:"text-blue-500"},"Liked",-1)]))):(n(),d("span",re,g[1]||(g[1]=[t("span",null,"👍",-1),t("span",null,"Like",-1)]))),t("span",{class:D(["ml-1",{"text-blue-500":s.value}])},h(c.value),3)]))}},ie={class:"p-6 flex space-x-2"},le={class:"flex-1"},ne={class:"flex justify-between items-center"},ae={class:"text-gray-800"},ce={class:"ml-2 text-sm text-gray-600"},de={key:0,class:"text-sm text-gray-600"},ue={key:0,class:"mt-2 relative"},me=["src"],ge=["src"],pe={class:"mt-2"},ve={class:"space-x-2"},fe={key:1},he={class:"mt-4 text-lg text-gray-900"},ye={key:0,class:"mt-3"},xe=["src"],be=["src"],ke={class:"flex items-center mt-2"},Le={__name:"Chirp",props:["chirp"],setup(o){L.extend(I);const i=$({message:o.chirp.message,media:null}),c=b(!1),s=b(null),y=r=>{const e=r.target.files[0];e&&(i.media=e,s.value=URL.createObjectURL(e))},u=r=>{var e;return typeof r=="string"?r==="image":(e=r==null?void 0:r.type)==null?void 0:e.startsWith("image/")},g=r=>{var e;return typeof r=="string"?r==="video":(e=r==null?void 0:r.type)==null?void 0:e.startsWith("video/")},k=r=>r?r.startsWith("http")?r:`${window.location.origin}${r}`:null,x=()=>{i.media=null,s.value&&(URL.revokeObjectURL(s.value),s.value=null)};return(r,e)=>(n(),d("div",ie,[e[10]||(e[10]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-gray-600 -scale-x-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)),t("div",le,[t("div",ne,[t("div",null,[t("span",ae,h(o.chirp.user.name),1),t("small",ce,h(a(L)(o.chirp.created_at).fromNow()),1),o.chirp.created_at!==o.chirp.updated_at?(n(),d("small",de," · edited")):v("",!0)]),o.chirp.user.id===r.$page.props.auth.user.id?(n(),z(V,{key:0},{trigger:f(()=>e[6]||(e[6]=[t("button",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"})])],-1)])),content:f(()=>[t("button",{class:"block w-full px-4 py-2 text-left text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:bg-gray-100 transition duration-150 ease-in-out",onClick:e[0]||(e[0]=l=>c.value=!0)}," Edit "),p(T,{as:"button",href:r.route("chirps.destroy",o.chirp.id),method:"delete"},{default:f(()=>e[7]||(e[7]=[C(" Delete ")])),_:1},8,["href"])]),_:1})):v("",!0)]),c.value?(n(),d("form",{key:0,onSubmit:e[4]||(e[4]=_(l=>{a(i).put(r.route("chirps.update",o.chirp.id),{onSuccess:()=>{c.value=!1,x()}})},["prevent"]))},[S(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>a(i).message=l),class:"mt-4 w-full text-gray-900 border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 rounded-md shadow-sm"},null,512),[[B,a(i).message]]),p(M,{message:a(i).errors.message,class:"mt-2"},null,8,["message"]),s.value||o.chirp.media_url?(n(),d("div",ue,[t("button",{onClick:_(x,["prevent"]),class:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",title:"Remove media"},e[8]||(e[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])),s.value&&u(a(i).media)||!s.value&&u(o.chirp.media_type)?(n(),d("img",{key:0,src:s.value||o.chirp.media_url,alt:"Media preview",class:"rounded-lg max-h-96 object-contain",onError:e[2]||(e[2]=l=>l.target.src="/path/to/fallback-image.png")},null,40,me)):s.value&&g(a(i).media)||!s.value&&g(o.chirp.media_type)?(n(),d("video",{key:1,src:s.value||o.chirp.media_url,controls:"",class:"rounded-lg max-h-96 w-full"}," Your browser does not support the video tag. ",8,ge)):v("",!0)])):v("",!0),t("div",pe,[t("input",{type:"file",onChange:y,accept:"image/*,video/*",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32)]),p(M,{message:a(i).errors.media,class:"mt-2"},null,8,["message"]),t("div",ve,[p(E,{class:"mt-4"},{default:f(()=>e[9]||(e[9]=[C("Save")])),_:1}),t("button",{class:"mt-4",onClick:e[3]||(e[3]=l=>{c.value=!1,a(i).reset(),x(),a(i).clearErrors()})},"Cancel")])],32)):(n(),d("div",fe,[t("p",he,h(o.chirp.message),1),o.chirp.media_url?(n(),d("div",ye,[u(o.chirp.media_type)?(n(),d("img",{key:0,src:k(o.chirp.media_url),alt:"Chirp media",class:"rounded-lg max-h-96 object-contain",onError:e[5]||(e[5]=l=>console.error("Image failed to load:",l))},null,40,xe)):g(o.chirp.media_type)?(n(),d("video",{key:1,src:k(o.chirp.media_url),controls:"",class:"rounded-lg max-h-96 w-full"}," Your browser does not support the video tag. ",8,be)):v("",!0)])):v("",!0)])),t("div",ke,[p(oe,{"chirp-id":o.chirp.id,likes:o.chirp.likes.length,"is-liked":o.chirp.likes.some(l=>l.user_id===r.$page.props.auth.user.id)},null,8,["chirp-id","likes","is-liked"])]),p(te,{"chirp-id":o.chirp.id,comments:o.chirp.comments,class:"mt-4"},null,8,["chirp-id","comments"])])]))}};export{Le as _};
